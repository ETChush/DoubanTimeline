{{define "index.html"}}<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoubanTimeline - 电影观看记录</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <header>
        <div class="header-left">
            <h1>DoubanTimeline</h1>
            <nav class="tab-nav">
                <a href="/" class="tab-link active">豆瓣</a>
                <a href="/jav" class="tab-link">JAV</a>
            </nav>
        </div>
        <div class="header-right">
            {{if .FavoritesOnly}}
            <a href="/" class="btn-favorite">♥ 显示全部</a>
            {{else}}
            <a href="/?favorites=true" class="btn-favorite">♡ 我的最爱</a>
            {{end}}
            <a href="#add-movie" class="btn-add">+ 添加电影</a>
        </div>
    </header>

    {{if .ErrorMsg}}
    <div class="message error">
        {{.ErrorMsg}}
    </div>
    {{end}}

    {{if .SuccessMsg}}
    <div class="message success">
        {{.SuccessMsg}}
    </div>
    {{end}}

    <main class="timeline">
        {{range .Groups}}
        <div class="timeline-item">
            <div class="timeline-label">
                <div class="year">{{.Year}}</div>
                <div class="month">{{.Month}}</div>
            </div>
            <div class="timeline-content">
                <div class="movie-grid">
                    {{range .Movies}}
                    <div class="movie-card">
                        <div class="movie-poster">
                            {{if .ImageURL}}
                            <img src="{{.ImageURL}}" alt="{{.Title}}">
                            {{else}}
                            <div class="movie-poster-placeholder">无图片</div>
                            {{end}}
                            <div class="movie-overlay">
                                <div class="movie-overlay-content">
                                    <div class="movie-date">{{formatFullDate .WatchedAt}}</div>
                                    <div class="movie-actions">
                                        <form method="POST" action="/toggle-favorite" style="display: inline;">
                                            <input type="hidden" name="id" value="{{.ID}}">
                                            {{if $.FavoritesOnly}}
                                            <input type="hidden" name="from_favorites" value="true">
                                            {{end}}
                                            <button type="submit" class="btn-favorite-icon" title="{{if .IsFavorite}}取消收藏{{else}}添加到最爱{{end}}">
                                                {{if .IsFavorite}}♥{{else}}♡{{end}}
                                            </button>
                                        </form>
                                        <a href="#delete-{{.ID}}" class="btn-delete">删除</a>
                                    </div>
                                </div>
                            </div>
                            {{if .IsFavorite}}
                            <div class="favorite-badge">♥</div>
                            {{end}}
                        </div>
                        <div class="movie-info">
                            <div class="movie-rating">{{formatRating .Rating}}</div>
                            <div class="movie-year">{{.Year}}</div>
                            {{if .DoubanURL}}
                            <a href="{{.DoubanURL}}" target="_blank" class="movie-title" title="{{.Title}}">{{.Title}}</a>
                            {{else}}
                            <div class="movie-title" title="{{.Title}}">{{.Title}}</div>
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
        {{end}}
    </main>
</div>

<!-- CSS Modal -->
<div id="add-movie" class="modal">
    <div class="modal-content">
        <a href="#" class="modal-close">&times;</a>
        <h2>添加电影</h2>
        <form method="POST" action="/add">
            <div class="form-group">
                <label for="douban_url">豆瓣链接 *</label>
                <input type="url" id="douban_url" name="douban_url" required placeholder="https://movie.douban.com/subject/...">
            </div>
            <div class="form-group">
                <label for="watched_at">观看时间</label>
                <input type="date" id="watched_at" name="watched_at" value="{{formatDate (now)}}">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn-submit">添加</button>
                <a href="#" class="btn-cancel">取消</a>
            </div>
        </form>
    </div>
    <a href="#" class="modal-overlay"></a>
</div>

<!-- 删除确认对话框 -->
{{range .Groups}}
{{range .Movies}}
<div id="delete-{{.ID}}" class="modal">
    <div class="modal-content">
        <a href="#" class="modal-close">&times;</a>
        <h2>确认删除</h2>
        <p>确定要删除《{{.Title}}》吗？此操作不可恢复。</p>
        <form method="POST" action="/delete" class="delete-form">
            <input type="hidden" name="id" value="{{.ID}}">
            <div class="form-actions">
                <button type="submit" class="btn-submit btn-danger">确认删除</button>
                <a href="#" class="btn-cancel">取消</a>
            </div>
        </form>
    </div>
    <a href="#" class="modal-overlay"></a>
</div>
{{end}}
{{end}}
</body>
</html>
{{end}}
